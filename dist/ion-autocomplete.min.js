/*!
 * ion-autocomplete 0.1.0
 * Copyright 2015 Danny Povolotski 
 * Copyright modifications 2015 Guy Brand 
 * https://github.com/guylabs/ion-autocomplete
 */
!function(){"use strict";angular.module("ion-autocomplete",[]).directive("ionAutocomplete",["$ionicTemplateLoader","$ionicBackdrop","$rootScope","$document","$q",function(a,b,c,d,e){return{require:"?ngModel",restrict:"E",template:'<input type="text" readonly="readonly" class="ion-autocomplete" autocomplete="off">',replace:!0,scope:{itemsMethod:"&",itemsMethodValueKey:"@",itemValueKey:"@",itemViewValueKey:"@"},link:function(c,f,g,h){if(h){var i="";g.placeholder&&(i=g.placeholder,f.attr("placeholder",g.placeholder));var j="Cancel";g.cancelLabel&&(j=g.cancelLabel),c.items=[],c.searchQuery="",c.getItemValue=function(a,b){var c;return c=b&&angular.isObject(a)?a[b]:a};var k=['<div class="ion-autocomplete-container">','<div class="bar bar-header item-input-inset">','<label class="item-input-wrapper">','<i class="icon ion-ios7-search placeholder-icon"></i>','<input type="search" class="ion-autocomplete-search" ng-model="searchQuery" placeholder="'+i+'"/>',"</label>",'<button class="ion-autocomplete-cancel button button-clear">',j,"</button>","</div>",'<ion-content class="has-header has-header">',"<ion-list>",'<ion-item ng-repeat="item in items" type="item-text-wrap" ng-click="selectItem(item)">',"{{getItemValue(item, itemViewValueKey)}}","</ion-item>","</ion-list>","</ion-content>","</div>"].join("");a.compile({template:k,scope:c,appendTo:d[0].body}).then(function(a){var c=angular.element(a.element.find("input"));a.scope.selectItem=function(c){a.scope.items=[],a.scope.searchQuery="",h.$setViewValue(c),h.$render(),a.element.css("display","none"),b.release()},a.scope.$watch("searchQuery",function(b){if(""==b&&(a.scope.items=[]),b&&angular.isFunction(a.scope.itemsMethod)){var c=e.when(a.scope.itemsMethod({query:b}));c.then(function(b){a.scope.items=a.scope.getItemValue(b,a.scope.itemsMethodValueKey)},function(a){return e.reject(a)})}});var d=function(d){d.preventDefault(),d.stopPropagation(),b.retain(),a.element.css("display","block"),c[0].focus(),setTimeout(function(){c[0].focus()},0)};f.bind("click",d),f.bind("touchend",d),a.element.find("button").bind("click",function(){a.scope.searchQuery="",b.release(),a.element.css("display","none")})}),h.$render=function(){var a=c.getItemValue(h.$viewValue,c.itemViewValueKey);f.val(a)},h.$formatters.unshift(function(a){return c.getItemValue(a,c.itemViewValueKey)}),h.$parsers.unshift(function(a){return c.getItemValue(a,c.itemValueKey)})}}}}])}();